{% extends 'fragments/dashboard-frag.html' %}
{% load static %}

{% block title %}
  Chat
{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/chat.css' %}" />
  <link rel="stylesheet" href="{% static 'css/chatting.css' %}" />
  {{ request.user.username|json_script:'me-username' }}
  {{ receiver.username|json_script:'other-user' }}
  {{ room_name|json_script:'room-name' }}
{% endblock %}

{% block page_title %}
  <div class="user-info">
    {% for receiver_profile in userprofile %}
      {% if receiver.username == receiver_profile.user.username %}
        {% if receiver_profile.user_pic %}
          <img src="{{ receiver_profile.user_pic.url }}" alt="{{ receiver_profile.username }}'s profile picture" />
        {% else %}
          <img src="{% static 'avatars/default-avatar.png' %}" alt="Default Avatar" />
        {% endif %}
        <h1 class="username">{{ receiver_profile.username }}</h1>
      {% endif %}
    {% endfor %}
  </div>
{% endblock %}

{% block content %}
  <div class="message">
    <div class="chat-user">
      {% if is_admin %}
        {% include 'fragments/admin-links.html' %}
      {% elif is_teacher %}
        {% include 'fragments/teacher-links.html' %}
      {% else %}
        {% include 'fragments/student-links.html' %}
      {% endif %}
    </div>
    {% if is_teacher %}
      {% include 'fragments/user-list-teacher.html' %}
    {% elif is_admin %}
      {% include 'fragments/user-list-admin.html' %}
    {% else %}
      {% include 'fragments/user-list-student.html' %}
    {% endif %}

    <!-- MESSAGE HERE -->
    <div class="messages-holder">
      <div class="message-content">
        <div class="message-data" id="chat-log">
          {% for chat_message in chat_messages %}
            <div class="{% if chat_message.sender.user == request.user %}
                
                sender

              {% else %}
                
                 receiver

              {% endif %}">
              <p>{{ chat_message.message }}</p>
              <p class="data">{{ chat_message.timestamp }}</p>
            </div>
          {% empty %}
            <p class="no-message">No Message Yet.</p>
          {% endfor %}
        </div>
      </div>
      <div class="message-form">
        <div class="form" action="">
          <input type="text" placeholder="Write a message..." class="message-input" id="message-input" />

          <div class="right-icons">
            <i class="far fa-smile emoji-btn"></i>
            <button type="button" class="send-btn" id="send-button"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script src="{% static 'js/chat.js' %}"></script>
  <script src="{% static 'js/chatting.js' %}"></script>
  <script src="{% static 'js/online-status.js' %}"></script>
  <script src="{% static 'js/vanillaEmojiPicker.js' %}"></script>
  <script></script>
{% endblock %}
