{% extends 'a_school_admin/dashboard-frag.html' %}
{% load static %}

{% block title %}
  Dashboard | Class Management
{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'a_school_admin/css/add-class.css' %}" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" />
{% endblock %}

{% block page_title %}
  <h2></h2>
  <div class="user-info">
    <h1 class="username">Add Class</h1>
  </div>
{% endblock %}

{% block content %}
  <form method="post" class="add-class-form">
    {% csrf_token %}
    <h2>Add Class Info</h2>

    <div class="form-row">
      <div class="form-group">
        <label for="class-name">Class Name</label>
        <input name="class_name" id="class-name" required />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="home-teacher">Homeroom Teacher</label>
        <select name="home_room_teacher" id="home-teacher" required>
          <option disabled selected value="">Home Room Teacher</option>
          {% for home_room_teacher in home_room_teachers %}
            <option value="{{ home_room_teacher.username }}">{{ home_room_teacher.username }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="table-container">
        <table id="studentsTable" class="classTable">
          <thead>
            <tr>
              <th>Username</th>
              <th>Age</th>
              <th>Select</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
              <tr>
                <td>{{ student.user.username }}</td>
                <td>{{ student.user.age }}</td>
                <td>
                  {% include 'fragments/checkbox.html' with checkbox_name=profile.username %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="crud">
      <a href="{% url 'class_mang_url' %}"><button type="button" class="delete-btn right-btn">Cancel</button></a>
      <button type="submit" class="edit-btn left-btn">Save</button>
    </div>
  </form>
{% endblock %}

{% block script %}
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script>
    $(document).ready(function () {
      const table = $('#studentsTable').DataTable({
        responsive: true,
        initComplete: function () {
          $('.dataTables_length label')
            .contents()
            .filter(function () {
              return this.nodeType === 3
            })
            .each(function () {
              this.textContent = this.textContent.replace('entries', '').trim()
              this.textContent = this.textContent.replace('Show', '').trim()
            })
    
          $('.dataTables_filter label')
            .contents()
            .filter(function () {
              return this.nodeType === 3
            })
            .each(function () {
              this.textContent = this.textContent.replace('Search:', '').trim()
            })
    
          // Now append your <p>…
          const labelEl = document.querySelector('.dataTables_length label')
          const selectList = document.createElement('p')
          selectList.className = 'select-label'
          selectList.textContent = 'Show'
          labelEl.appendChild(selectList)
    
          // Now append your <p>…
          const labelSR = document.querySelector('.dataTables_filter label')
          const searchList = document.createElement('p')
          searchList.className = 'search-label'
          searchList.textContent = 'Search'
          labelSR.appendChild(searchList)
        }
      })
    })
    document.querySelector('.add-class-form').addEventListener('submit', function (e) {
      const classInput = document.getElementById('class-name')
      const value = classInput.value.trim().toUpperCase()
      const pattern = /^(1[0-4]|[1-9])[A-H]$/
    
      if (!pattern.test(value)) {
        e.preventDefault()
        Swal.fire({
          icon: 'error',
          title: 'Invalid Class Name',
          text: 'Class name must start with 1–14 followed by a letter A–H. Example: 1A, 9B, 12C.',
          timer: 5000,
          showConfirmButton: false
        })
      }
    })
  </script>
{% endblock %}
